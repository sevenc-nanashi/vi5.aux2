// vi5-cef to vi5-cef-server
syntax = "proto3";
package libserver;

import "common.proto";

enum LogNotificationLevel {
  LOG_NOTIFICATION_LEVEL_INFO = 0;
  LOG_NOTIFICATION_LEVEL_WARN = 1;
  LOG_NOTIFICATION_LEVEL_ERROR = 2;
}

message Notification {
  oneof notification {
    LogNotification log_notification = 1;
    ObjectInfosNotification object_info_notification = 2;
  }
}

message LogNotification {
  LogNotificationLevel level = 1;
  string message = 2;
}

message ObjectInfosNotification {
  repeated common.ObjectInfo object_infos = 1;
}

message InitializeRequest { string root_path = 1; }

message InitializeResponse {
  string project_name = 1;
  string renderer_version = 2;
}

message BatchRenderResponse { repeated RenderResponse render_responses = 1; }

message RenderResponse {
  int32 render_nonce = 1;
  oneof response {
    SuccessRenderResponse success = 2;
    string error_message = 3;
  }
}
message SuccessRenderResponse {
  int32 width = 1;
  int32 height = 2;
  bytes image_data = 3;
}

service LibServer {
  rpc Initialize(InitializeRequest) returns (InitializeResponse);
  rpc BatchRender(common.BatchRenderRequest) returns (BatchRenderResponse);
  rpc PurgeCache(common.Void) returns (common.Void);
  rpc SubscribeNotifications(common.Void) returns (stream Notification);
  rpc Shutdown(common.Void) returns (common.Void);
}

